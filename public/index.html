<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cognitive Consulting â€” Research Q&A</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="page">

    <!-- Header -->
    <header class="header">
      <h1 class="title">Research Q&amp;A</h1>
      <img src="/assets/Cog_OUTLOOK_SIG.png" alt="Cognitive Consulting" class="logo-small" />
    </header>

    <!-- Search -->
    <section class="card search-card">
      <div class="search-row">
        <input id="q" class="search-input" placeholder="Ask about your research, e.g., How has satisfaction for Product X changed over time?" />
        <button id="askBtn" class="btn ask">Ask</button>
      </div>
    </section>

    <!-- Results -->
    <div id="results" class="results">

      <section class="card">
        <h2 class="section-title">Key Findings</h2>
        <div id="keyFindingsEmpty" class="muted">Ask a question to see findings.</div>
        <ul id="keyFindings" class="bullets" hidden></ul>
        <div id="createReportWrap" class="mt" hidden>
          <button id="createReportBtn" class="btn dark">Create report</button>
        </div>
      </section>

      <section class="card">
        <h2 class="section-title">Supporting Details</h2>
        <div id="supportingEmpty" class="muted">No supporting visuals found.</div>
        <div id="supportingGrid" class="grid2" hidden></div>
      </section>

      <section class="card">
        <h2 class="section-title">References</h2>
        <div id="refsEmpty" class="muted">No references detected.</div>
        <div id="refsGrid" class="grid3" hidden></div>

        <div id="sourcesWrap" class="mt small" hidden>
          <div class="small-bold">Sources</div>
          <ul id="sourcesList" class="bullets-inline"></ul>
        </div>
      </section>

    </div>
  </div>

  <script>
    // Basic client-side JS to avoid [object Object] in references
    async function askQuestion() {
      const q = document.getElementById("q").value.trim();
      if (!q) return;

      const res = await fetch(`/search?q=${encodeURIComponent(q)}`);
      const data = await res.json();

      // Key findings
      const keyList = document.getElementById("keyFindings");
      keyList.innerHTML = "";
      if (data.keyFindings?.length) {
        document.getElementById("keyFindingsEmpty").hidden = true;
        keyList.hidden = false;
        data.keyFindings.forEach(f => {
          const li = document.createElement("li");
          li.textContent = f;
          keyList.appendChild(li);
        });
      }

      // References
      const sourcesList = document.getElementById("sourcesList");
      sourcesList.innerHTML = "";
      if (data.sources?.length) {
        document.getElementById("sourcesWrap").hidden = false;
        data.sources.forEach(src => {
          const li = document.createElement("li");
          if (src.name && src.link) {
            const a = document.createElement("a");
            a.href = src.link;
            a.textContent = src.name;
            a.target = "_blank";
            li.appendChild(a);
          } else {
            li.textContent = typeof src === "string" ? src : JSON.stringify(src);
          }
          sourcesList.appendChild(li);
        });
      }
    }

    document.getElementById("askBtn").addEventListener("click", askQuestion);
  </script>
</body>
</html>
